function createTrackItem(e){const t=document.querySelector("#at-track-template").content.cloneNode(!0).firstElementChild;return t.querySelector(".at-track-name").innerText=e.name,t.track=e,t.onclick=(t=>{t.stopPropagation(),api.renderTracks([e])}),t}function formatDuration(e){let t=e/1e3;const a=t/60|0;return t=t-60*a|0,String(a).padStart(2,"0")+":"+String(t).padStart(2,"0")}const wrapper=document.querySelector(".at-wrap"),main=wrapper.querySelector(".at-main"),filePath=document.getElementById("alphaTabWrapper").dataset.tabFile,settings={file:filePath,player:{enablePlayer:!0,soundFont:"https://cdn.jsdelivr.net/npm/@coderline/alphatab@latest/dist/soundfont/sonivox.sf2",scrollElement:wrapper.querySelector(".at-viewport")}},api=new alphaTab.AlphaTabApi(main,settings),overlay=wrapper.querySelector(".at-overlay");api.renderStarted.on(()=>{overlay.style.display="flex"}),api.renderFinished.on(()=>{overlay.style.display="none"});const trackList=wrapper.querySelector(".at-track-list");api.scoreLoaded.on(e=>{trackList.innerHTML="",e.tracks.forEach(e=>{trackList.appendChild(createTrackItem(e))})}),api.renderStarted.on(()=>{const e=new Map;api.tracks.forEach(t=>{e.set(t.index,t)}),trackList.querySelectorAll(".at-track").forEach(t=>{e.has(t.track.index)?t.classList.add("active"):t.classList.remove("active")})}),api.scoreLoaded.on(e=>{wrapper.querySelector(".at-song-title").innerText=e.title,wrapper.querySelector(".at-song-artist").innerText=e.artist});const countIn=wrapper.querySelector(".at-controls .at-count-in");countIn.onclick=(()=>{countIn.classList.toggle("active"),countIn.classList.contains("active")?api.countInVolume=1:api.countInVolume=0});const metronome=wrapper.querySelector(".at-controls .at-metronome");metronome.onclick=(()=>{metronome.classList.toggle("active"),metronome.classList.contains("active")?api.metronomeVolume=1:api.metronomeVolume=0});const loop=wrapper.querySelector(".at-controls .at-loop");loop.onclick=(()=>{loop.classList.toggle("active"),api.isLooping=loop.classList.contains("active")}),wrapper.querySelector(".at-controls .at-print").onclick=(()=>{api.print()});const zoom=wrapper.querySelector(".at-controls .at-zoom select");zoom.onchange=(()=>{const e=parseInt(zoom.value)/100;api.settings.display.scale=e,api.updateSettings(),api.render()});const layout=wrapper.querySelector(".at-controls .at-layout select");layout.onchange=(()=>{switch(layout.value){case"horizontal":api.settings.display.layoutMode=alphaTab.LayoutMode.Horizontal;break;case"page":api.settings.display.layoutMode=alphaTab.LayoutMode.Page}api.updateSettings(),api.render()});const playerIndicator=wrapper.querySelector(".at-controls .at-player-progress");api.soundFontLoad.on(e=>{const t=Math.floor(e.loaded/e.total*100);playerIndicator.innerText=t+"%"}),api.playerReady.on(()=>{playerIndicator.style.display="none"});const playPause=wrapper.querySelector(".at-controls .at-player-play-pause"),stop=wrapper.querySelector(".at-controls .at-player-stop");playPause.onclick=(e=>{e.target.classList.contains("disabled")||api.playPause()}),stop.onclick=(e=>{e.target.classList.contains("disabled")||api.stop()}),api.playerReady.on(()=>{playPause.classList.remove("disabled"),stop.classList.remove("disabled")}),api.playerStateChanged.on(e=>{const t=playPause.querySelector("i.fas");e.state===alphaTab.synth.PlayerState.Playing?(t.classList.remove("fa-play"),t.classList.add("fa-pause")):(t.classList.remove("fa-pause"),t.classList.add("fa-play"))});const songPosition=wrapper.querySelector(".at-song-position");let previousTime=-1;api.playerPositionChanged.on(e=>{(e.currentTime/1e3|0)!=previousTime&&(songPosition.innerText=formatDuration(e.currentTime)+" / "+formatDuration(e.endTime))});